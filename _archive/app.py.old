import os
import psycopg2
from dotenv import load_dotenv
from flask import Flask, jsonify

load_dotenv()  # loads variables from .env file into environment

app = Flask(__name__)

connection = psycopg2.connect(
    dbname=os.environ.get("db_name"),
    user=os.environ.get("db_user"),
    password=os.environ.get("db_password"),
    host=os.environ.get("db_host")
)

SELECT_ALL_ACTORS = "SELECT * FROM actor;"


@app.route("/api/actors", methods=["GET"])
def get_all_actors():
    with connection:
        with connection.cursor() as cursor:
            cursor.execute(SELECT_ALL_ACTORS)
            actors = cursor.fetchall()
            if actors:
                result = []
                for actor in actors:
                    result.append({"actor_id": actor[0], "first_name": actor[1], "last_name": actor[2], "last_update": actor[3]})
                return jsonify(result)
            else:
                return jsonify({"error": f"Users not found."}), 404

@app.route("/api/actors/<int:actor_id>", methods=["GET"])
def get_actor(actor_id):
    with connection:
        with connection.cursor() as cursor:
            cursor.execute("SELECT * FROM actor WHERE actor_id = %s", (actor_id,))
            actor = cursor.fetchone()
            if actor:
                return jsonify({"actor_id": actor[0], "first_name": actor[1], "last_name": actor[2], "last_update": actor[3]})
            else:
                return jsonify({"error": f"User with ID {actor_id} not found."}), 404